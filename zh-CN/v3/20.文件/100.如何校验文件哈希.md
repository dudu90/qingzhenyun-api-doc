## 文件哈希分为2个部分，一部分为文件指纹，计算方法如下所示，另一部分为文件大小的 ```36``` 进制小写表示。

#### 1、文件小于等于4MB的时候：


1. 对文件内容做sha1计算；
2. 在sha1值（20字节）前拼上单个字节，值为0x16；

  +---------------+
  |     <=4MB     |
  +---------------+
   \      |      /
    \   sha1()  /
     \    |    /
      \   V   /
    +--+-----+ 
    |1B| 20B |    
    +--+-----+  
     |  |           
     |  |        
     |  |
     |  \------文件内容的sha1值 
     |
     |
     |
     \------ 固定为0x16
     
  +-------------------------+
  
  3. 对拼接好的21字节的二进制数据做```url_safe_base64```计算，再拼接上文件大小的36进制表示，所得结果即为ETag值。
  
  +----------------+------------------+ 
  |url_safe_base64 |36 base file size |
  +----------------+------------------+ 



#### 2、文件大于4MB的时候：



1. 对文件内容按4M大小切块；

2. 对每个块做sha1计算；

         +----------+----------+-------
         |    4MB   |   4MB    | ...              <----- 原始数据，按4MB切块
         +----------+----------+-------
          \    |    |   |     /
           \ sha1() | sha1() /                    <----- 每一块进行SHA1计算
            \  |    |   |   /
             \ V    |   V  /
              +-----+-----+-------
              | 20B | 20B | ...                   <----- 拼接每一块的SHA1结果
              +-----+-----+-------
               \      |      /
                \   sha1()  /                     <----- 拼接结果再次SHA1
                 \    |    /
                  \   V   /
                +--+-----+
                |1B| 20B |                        <----- 0x96 加 二次 SHA1 结果 
                +--+-----+         然后在二次 sha1 值前拼上单个字节，值为0x96；
                 |  |
                 |  \---- 二次sha1的值
                 \------- 固定为0x96

4. 对拼接好的21字节的二进制数据做url_safe_base64计，再拼接上文件大小的36进制表示，所得结果即为ETag值。
  
  +----------------+------------------+ 
  |url_safe_base64 |36 base file size |
  +----------------+------------------+ 

